# Helm Charts for Aria Operator

**NOTE:** These charts are not for use outside of Aria Hub. They will not work for standalone Wavefront/OpApps customers.

## Aria Operator Chart
Generated by release scripts.

## Installing

**Helm 3.8+**

Helm 3.8 adopted a different distribution model for Charts. OCI image registries are the preferred method of
distributing Charts going forward.

**Namespace:** the only currently supported namespace for deploying these charts is `observability-system`.

```
helm --namespace observability-system install aria-operator \
  oci://projects.registry.vmware.com/tanzu_observability/helm-charts/aria-operator

  helm pull oci://projects.registry.vmware.com/tanzu_observability_keights_saas/helm-charts/aria-operator --version 0.1.1-main

helm --namespace observability-system install aria-hub \
  oci://projects.registry.vmware.com/tanzu_observability/helm-charts/aria-hub \
  --set clusterName=<CLUSTER_NAME> \
  --set k8sEvents.url=<URL> \
  --set k8sEvents.token=<LEMANS_TOKEN>
```

## Uninstalling
Run the following commands in this order.

```
helm --namespace observability-system uninstall aria-hub

helm --namespace observability-system uninstall aria-operator
```

If you ran the commands in the wrong order, you may see this error `Error: failed to delete release: aria-hub`. 

If you do, you will need to additionally run the following command before you can reinstall aria-hub:

```
kubectl --namespace observability-system delete secret sh.helm.release.v1.aria-hub.v1
```

## Developing

To package, push, and install a helm chart to Harbor Dev:
```
helm package ./aria-operator
helm push aria-operator-*.tgz oci://projects.registry.vmware.com/tanzu_observability_keights_saas/helm-charts

helm package ./aria-hub
helm push aria-hub-*.tgz oci://projects.registry.vmware.com/tanzu_observability_keights_saas/helm-charts

# Install the charts auto-published in CI for the `main` branch
helm --namespace observability-system install aria-operator \
  oci://projects.registry.vmware.com/tanzu_observability_keights_saas/helm-charts/aria-operator --version 0.1.1-main

helm --namespace observability-system install aria-hub \
  oci://projects.registry.vmware.com/tanzu_observability_keights_saas/helm-charts/aria-hub --version 0.1.1-main \
  --set clusterName=<CLUSTER_NAME> \
  --set k8sEvents.url=<URL> \
  --set k8sEvents.token=<LEMANS_TOKEN>
```

To package and push a helm chart to Harbor Prod:
```
helm package ./aria-operator
helm push aria-operator-*.tgz oci://projects.registry.vmware.com/tanzu_observability/helm-charts

helm package ./aria-hub
helm push aria-hub-*.tgz oci://projects.registry.vmware.com/tanzu_observability/helm-charts
```

