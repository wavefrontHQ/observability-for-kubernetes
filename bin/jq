#!/usr/bin/env bash
set -euo pipefail

BIN_DIR=$(dirname $(realpath "$0"))

VERSION=jq-1.7rc1
if [[ ! -f "$BIN_DIR/.cache/jq" ]]; then
    printf "downloading jq %s ..." "$VERSION" 1>&2
    OS=$(go env GOOS)
    case $OS in
        darwin)
            OS="macos"
            ;;
        linux)
            OS="linux"
            ;;
    esac
    ARCH=$(go env GOARCH)
    mkdir -p "$BIN_DIR/.cache"
    rm -rf "$BIN_DIR/.cache/jq"
    curl --silent -L --output "$BIN_DIR/.cache/jq" "https://github.com/jqlang/jq/releases/download/${VERSION}/jq-${OS}-${ARCH}"
    printf "."
    chmod +x "$BIN_DIR/.cache/jq"
    printf "."
    echo " done." 1>&2
fi

# shellcheck disable=SC2086
"$BIN_DIR/.cache/jq" $*